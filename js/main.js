let data = [
  {
    "title": "Castle in the Sky",
    "description": "“Never love a wild thing, Mr. Bell,' Holly advised him. 'That was Doc's mistake. He was always lugging home wild things. A hawk with a hurt wing. One time it was a full-grown bobcat with a broken leg. But you can't give your heart to a wild thing: the more you do, the stronger they get. Until they're strong enough to run into the woods. Or fly into a tree. Then a taller tree. Then the sky. That's how you'll end up, Mr. Bell. If you let yourself love a wild thing. You'll end up looking at the sky. 'She's drunk,' Joe Bell informed me. "
     + "Moderately, Holly confessed....Holly lifted her martini. 'Let's wish the Doc luck, too,' she said, touching her glass against mine. 'Good luck: and believe me, dearest Doc -- it's better to look at the sky than live there. Such an empty place; so vague. Just a country where the thunder goes and things disappear.'",
    "release_date": "2018",
    "image": "url('./images/boston_a-min.jpg')"
  },
  {
    "title": "Castle in the Sky",
    "description": "不知道为什么在我的印象里，我是从来没有度过情人、七夕等属于两个人的节日，倒是记得在这些日子里逛书店买书的潇梦，若是要我选，我定然要说“书是我一生的情人”然后直接扑倒在“知识的海洋”里，不断沉沉浮浮、飘飘荡荡，淹死也不足为过。就这样过惯了没有佳人的七夕，我反而疑惑到底何谓佳人、何谓七夕。世俗对于前者的定义向来没有统一过，或身边人不佳，却也还是个人；或认为情侣算佳，却总因为过高的期待而不被当人看。我看百度百科说“佳人”一词应释义为“美好的人”，那一细想，十八年来我也算遇到了不少的人，高高矮矮、胖胖瘦瘦、黑黑白白，都是佳人。至于七夕，世人总说要共度美景、分享年华，反衬着那些凭栏故作的哀叹，我更愿将七夕时分视作与美好事物的通感和共鸣，有无佳人相伴、无非是庸人自扰，还抵不过我在午夜时收到的一封来信",
    "release_date": "2018",
    "image": "url('./images/boston_a-min.jpg')"
  },
  {
    "title": "Grave of the Fireflies",
    "description": " “突然间闻到一股香气，像小时候那种新开封的橡皮泥，粉嫩又有些油油的。总有女孩子身上带着这种香气，每个人都有不一样的气息。《香水》里那个主人公一定很迷恋这种气味。想起戴望舒笔下那个丁香一般的女孩，香味飘忽不定，却又始终撩拨着你的鼻翼与内心，不经意就会沉浸其中。循香看去，那刹那失了神。细腻白皙的皮肤，正与身边人说着笑语，眼睛弯成两道月牙，头上扎个辫子 ，这个画面混杂着令人无法言说的美定格在眼前。干净，活泼，那么让人喜欢。似乎有些明白静若处子是一种怎样的感觉，就像眼前突然出现一朵含苞待放的小花，洁白，青嫩，花瓣上隐约有几分娇嫩的红艳。记公车上一偶遇的小女孩。”",
    "release_date": "1992",
    "image": "url('./images/boston_d-min.jpg')"
  },
  {
    "title": "My Neighbor Totoro",
    "description": "我想，你之于我，也定若如此。你可是多么美好的人。",
    "release_date": "1993",
    "image": "url('./images/boston_b-min.jpg')"
  },
  {
    "title": "Kiki's Delivery Service",
    "description": "塞林格在The Heart of a Broken Story里有这么一句话，“If my love for you has only led me to a new and great sorrow, only I am to blame.” 直白的翻译来说，“如果对你的爱只将我带往新的沉痛，那也只是我活该。” 我想，即便我因为爱你而辗转反侧、痛哭流涕、甚而迷失自我，我也不会因此后悔，这一切都是我的选择和与之承担的一切。",
    "release_date": "1989",
    "image": "url('./images/boston_c-min.jpg')"
  },
  {
    "title": "Only Yesterday",
    "description": "“爱不止是情感、情绪、热情，爱其实真正是一种意志。”于我，爱亦是习惯，就像爱你也成为了难以改变的习惯一样。若想强扭着改变，无疑有两种情况，放血或是割肉，听着都可怕，就不细着解释了，总之都是痛的，更何况是深入骨髓。变又怎样，不变又怎样，早已如同过往一样，化为朝思暮想的盼头融于血肉了",
    "release_date": "1991",
    "image": "url(./images/boston_e-min.jpg"
  },
  {
    "title": "Only Yesterday",
    "description": "“爱不止是情感、情绪、热情，爱其实真正是一种意志。”于我，爱亦是习惯，就像爱你也成为了难以改变的习惯一样。若想强扭着改变，无疑有两种情况，放血或是割肉，听着都可怕，就不细着解释了，总之都是痛的，更何况是深入骨髓。变又怎样，不变又怎样，早已如同过往一样，化为朝思暮想的盼头融于血肉了",
    "release_date": "1991",
    "image": "url(./images/boston_f-min.jpg"
  },
  {
    "title": "Only Yesterday",
    "description": "刚才母上说有人在七夕前夜看到了流星，我一辈子都没看过，也不觉得许愿能够成真。北斗人有句名言叫“生而不易，愿同摘星。”这时我总会想起早已看过灿烂的星辰的我们。当然我也会和自己较真，细究着想我们曾一起看到过星辰到底是什么，难道是人类历史文化智慧的闪烁嘛，或是人类秉性里真善美的追求嘛，说的太大了肯定不会是错的答案，但绝不会是对的。就当作为向知己者、悦己者的谢礼吧。此情永不言谢。",
    "release_date": "1991",
    "image": "url(./images/boston_g-min.jpg"
  },
  {
    "title": "",
    "description": "我知道我比以前任何时候，都更爱你了。姑且不想用任何所谓“深沉”的形容词来装饰这份爱，倒还是一如既往的真挚。",
    "release_date": "2019",
    "image": "url('./images/boston_h-min.jpg')"
  },
  {
    "title": "",
    "description": "你是我的佳人嘛？最好的那个嘛？还是独属于我的那个吗？我不知道。",
    "release_date": "2019",
    "image": "url('./images/centennial_a-min.jpg')"
  },
  {
    "title": "",
    "description": "我只愿与你度过这个没有佳人的七夕。没有你，良辰美景，更与何人说。",
    "release_date": "2019",
    "image": "url('./images/vanderbilt_a-min.jpg')"
  }
];

const app = document.getElementById("wrap");
let slider = 0;

const container = document.createElement("div");
container.setAttribute("class", "container");
const inner = document.createElement("div");
inner.setAttribute("class", "inner");

app.appendChild(container);
container.appendChild(inner);

function loadFilms() {
  if (!data) {
    const errorMessage = document.createElement("marquee");
    errorMessage.textContent = `Something is no bueno`;
    app.appendChild(errorMessage);
    return;
  }
  data.forEach(movie => {
    const slide = document.createElement("div");
    const content = document.createElement("div");
    const bgimg = document.createElement("div");
    const img = document.createElement("div");
    let str = movie.title;
    str = str.replace(/\s+/g, "-").toLowerCase();
    str = str.replace(/'/g, "-");
    slide.setAttribute("class", "slide " + str);
    content.setAttribute("class", "content");
    bgimg.setAttribute("class", "bg");
    const h1 = document.createElement("h1");
    h1.textContent = movie.title;
    const h3 = document.createElement("h3");
    h3.textContent = movie.release_date;
    h3.setAttribute("data-splitting", "chars");
    h1.setAttribute("data-splitting", "words");
    const p = document.createElement("p");
    // movie.description = movie.description.substring(0, 400);
    movie.description = movie.description;
    p.textContent = `${movie.description}...`;

    inner.appendChild(slide);
    slide.appendChild(content);
    slide.appendChild(bgimg);
    bgimg.appendChild(img);
    img.style.backgroundImage = movie.image;

    slide.appendChild(h1);
    slide.appendChild(h3);
    content.appendChild(p);
  });

  $(".right").click(function () {
    let total = $(".slide").length;
    if (slider === (total - 1) * 100) {
      console.log("last one and redirect");
      // transition
      $(location).attr('href', './from-here')
      return;
    }
    console.log(slider);
    if (slider < (total - 1) * 100) {
      slider = slider + 100;
      $(".slide.active")
        .next()
        .addClass("active");
      $(".slide.active")
        .first()
        .removeClass("active");
    } else {
      slider = 0;
      $(".inner .slide").removeClass("active");
      $(".inner .slide")
        .first()
        .addClass("active");
    }
    $("body")
      .get(0)
      .style.setProperty("--slide", "-" + slider + "%");
  });

  $(".left").click(function () {
    let total = $(".slide").length;
    if (slider == 0) {
      slider = (total - 1) * 100;
      $(".slide")
        .last()
        .addClass("active");
      $(".slide")
        .first()
        .removeClass("active");
    } else {
      slider = slider - 100;
      $(".slide.active")
        .prev()
        .addClass("active");
      $(".slide.active")
        .last()
        .removeClass("active");
    }
    $("body")
      .get(0)
      .style.setProperty("--slide", "-" + slider + "%");
  });
};

let smallType = [
  "in the",
  "of the",
  "my ",
  "My ",
  "the ",
  "The ",
  "Up on",
  "Was "
];

$(".arrow").click(function () {
  $(".spritebox").toggleClass("zoomies");
});

function loadData() {
  // $.getJSON("../../for-him/textData/textData.json", function (data) { // for gh page
  // $.getJSON("../textData/textData.json", function (data) { // for local testing and netlify
  //   console.log("success when loading the data for the main page");
  //   console.log(data.text)
  //   loadFilms(data.text);
  // }).fail(function (jqxhr, status, error) {
  //   console.log('error', status, error)
  // });
  loadFilms();
};

function display() {
  setTimeout(function () {
    $.each(smallType, function (index, value) {
      $("h1:contains(" + value + ")").html(function (_, html) {
        let regex = new RegExp(value, "g");
        return html.replace(
          regex,
          '<span class="smallcaps">' + value + "</span>"
        );
      });
    });
    $("#wrap").addClass("loaded");
  }, 500);

  setTimeout(function () {
    $(".inner .slide")
      .first()
      .addClass("active");
  }, 700);
}

$(document).ready(function () {
  loadData();
  // display();
});

$(window).bind("load", function () {
  setTimeout(function () {
    console.log("successfully loaded the main page");
    $("#wrap").css("display", "flex");
    $('#loader').fadeOut();
    display();
  }, 1000);
});